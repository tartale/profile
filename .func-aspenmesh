#!/bin/bash

function cdc() {
  cd "${WORKSPACE}/clusters/$1"
}

function _complete_cdc {
  # only allow completion one subdir-deep
  if [[ ${COMP_CWORD} == 2 ]]; then
    return 0
  fi

  _complete_dir_helper "${WORKSPACE}/clusters"
}
complete -o filenames -F _complete_cdc cdc

function recentDownload()(
  ls -d -1t ${DOWNLOAD_PATH}/* 2>/dev/null | head -n 1
)

function previousDownload()(
  ls -d -1t ${DOWNLOAD_PATH}/* 2>/dev/null | head -n 2 | tail -n 1
)

function findDownload()(
  name="${1}"
  find -s ${DOWNLOAD_PATH} -name "*${name}*" -maxdepth 1
)

function valuesOverridesFile()(
  file="${PWD}/overrides-aspenmesh.yaml"
  if [ -f $file ]; then
    printf " --values ${PWD}/overrides-aspenmesh.yaml "
  fi
)

function glt() {
  if [[ $# -eq 0 ]]; then
    pkgs="${PWD}"
  else
    pkgs="$1"
  fi
  if [[ "${pkgs}" =~ .*test\/int.* ]]; then
    tags="--tags=intTest"
  fi
  ginkgo --dryRun -v ${tags} -r --compilers=1 --seed=1 "${pkgs}" | grep -v "Ran " | grep -v "Will run" | grep -v "Ginkgo ran" 
}
